## 0. Создать проект
Создать проект 02-blink-usb-com в папке mcu аналогично [[Занятие 1#3. Создаем первый проект]]. 

В итоге должна получиться следующая структура файлов.
```
mcu
|-- 01-blink
|-- 02-blink-usb-com
 	|-- main.c
 	|-- CMakeLists.txt
 	|-- memmap_rp2040.ld
    |-- pico_sdk_import.cmake
    
```

## 1. Реализовать в прошивке команды on() и off()
- Создать в папке [[файл с исходным кодом]] utils.c и [[заголовочный файл]] utils.h. 
-  В заголовочный файл ```utils.h ``` добавим библиотеку ```pico/stdlib.h``` 
``` c
#include "pico/stdlib.h"
```
- В заголовочном файле ``` utils.h``` объявить функции   ```led_on``` и ```led_off```:
``` c
void led_on(uint pin);
void led_off(uint pin);
```

- В файл с исходным кодом ```utils.c ``` добавим заголовочный файл ```utils.h``` и библиотеку ```hardware/gpio.h``` 
``` c
#include "utils.h"
#include "hardware/gpio.h"
```
- Добавить реализацию этих функций в ```utils.c``` :
``` c
void led_on(uint pin) {
	// Код реализующий логику включения светодиода
}

void led_off(uint pin) {
    // Код реализующий логику выключения светодиода
}
```

- Добавить в ```main.c ``` библиотеки ```hardware/gpio.h``` и ```pico/stdlib.h``` 
- Использовать функции ```led_on``` и ```led_off``` для мигания светодиода, увеличить период мигания светодиода
- Добавить в  ``` CMakeLists.txt ```  новый файл с исходным кодом ```utils.c.
``` cmake
... 
# Добавляем в проект файлы с исходным кодом - типовая строчка для любого CMakeLists.txt
add_executable(02_blink_usb_com
    ${CMAKE_CURRENT_SOURCE_DIR}/main.c
    ${CMAKE_CURRENT_SOURCE_DIR}/utils.c
)
```
- Собрать проект аналогично [[Занятие 1#4. Собираем в папке build]]
- Загрузить прошивку аналогично [[Занятие 1#5. Загружаем прошивку в Pico]]
- **Результат**: Устройство мигает с увеличенным периодом
## 2.  Помигать светодидом через COM-порт
- Скачать бинарный файл консольной программы [PUTTY](https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html).
- Добавить в ```CMakeLists.txt ``` перенаправление потока ввода/вывода с uart на usb после указания файла, в котором находится linker script:
``` cmake

# Перенаправляем поток ввода/вывода с uart на usb
pico_enable_stdio_usb(02_blink_usb_com 1)
pico_enable_stdio_uart(02_blink_usb_com 0)
```
- Добавить в ```main.c ``` инициализацию потока ввода/вывода и считывание с консоли STDIO перед инициализацией GPIO вывода:
``` c
stdio_init_all();
```
- Добавить после инициализации GPIO вывода объявить переменную ```userInput``` типа
  ```char``` . Через эту переменную пользователь сможет включать или выключать светодиод:
``` c
char userInput;
```
- В мастерцикле (бесконечном цикле) считать переменную вводимую пользователем с помощью функции ```getchar()```:
``` c
userInput = getchar();
```
- Реализовать логику включения светодиода при вводе символа ```e```. После включения необходимо вывести текущий статуй с помощью функции ```printf```:
``` c
printf("LED is ON \n");
```
- Реализовать логику включения светодиода при вводе символа ```d```. После включения необходимо вывести текущий статуй с помощью функции ```printf```
- В случае ввода некорректного символа, вывести сообщение об этом
- Собрать проект и загрузить прошивку
- Определить имя COM-порта:
	- Нажмите `Win + X` и выберите «Диспетчер устройств».
	- Разверните список **Порты (COM и LPT)**.
	- Устройство будет отображаться как «Название устройства (COM#)», например, `USB Serial Port (COM3)`.
	- Если устройство не отображается, выберите в меню «Вид» пункт «Показать скрытые устройства».
- Запустить и настроить PUTTY (выбрать тип соединения Serial,указать имя порта и скорость):
![[Pasted image 20260126154203.png]]

- **Результат**: Диод устройства включается по команде ```e``` и выключается по ```d``` в терминале PUTTY

## 3. Помигать светодиодом через Python-скрипт (on/off, задавать период)
- Проверить наличие python командой ```python --version ```, если нет то установить
- Установить ```pyserial``` для связи с COM-портом через python командой ```pip install pyserial ```
- Создать  скрипт ```control.py ``` 
- Импортировать библиотеки, настроить параметры COM-порта, не забыть закрыть COM-порт после окончания работы скрипта:
``` python
import serial, sys
  
serialName = 'COM13' 
serialBaudRate = 115200

ser = serial.Serial(serialName, baudrate=serialBaudRate)

print('start')
print('(e - switch on led / d - switch off led) / q - end execution\n')

try:
    while True:
        s = input()
        if s.startswith('q'):
            sys.exit(0)
        elif s.startswith('e'):
            sendStr = 'e'
        elif s.startswith('d'):
            sendStr = 'd'
        else:
            print(f'Invalid input: {s}')
            continue
        sendData = (sendStr + '\n').encode('ascii')
        ser.write(sendData)
        response = ser.readline()
        ser.flush()
        print(response)
finally:
    ser.close()
    print('closed')
```

## 4.  Реализовать в приборе команду toggle()
## 5. Помигать светодиодом через Python-скрипт (toggle, задавать период)
## 6.  Реализовать в приборе команды on_for(ms), off_for(ms), toggle_for(ms)
## 7. Помигать светодиодом через Python-скрипт (xx_for(ms))
## 8. Реализовать команду mem(addr) и Python-интерфейс к ней, проверить
## 9. Реализовать команду wmem(addr) и Python-интерфейс к ней, проверить
## 10. Запушить исходники прошивки и Python-интерфейс на GitHub
