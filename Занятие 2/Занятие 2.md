## 0. Создать проект
Создать проект 02-blink-usb-com в папке mcu аналогично [[Занятие 1#3. Создаем первый проект]]. 

В итоге должна получиться следующая структура файлов.
```
mcu
|-- 01-blink
|-- 02-blink-usb-com
 	|-- main.c
 	|-- CMakeLists.txt
    |-- pico_sdk_import.cmake
```

## 1. Реализовать в прошивке команды on() и off()
- Создать в папке [[файл с исходным кодом]] utils.c и [[заголовочный файл]] utils.h. 
- В заголовочном файле объявить функции   ```led_on``` и ```led_off```:
``` c
#ifndef UTILS_H
#define UTILS_H

#include "pico/stdlib.h"

void led_on(uint pin);
void led_off(uint pin);

#endif  // UTILS_H
```

- Добавить реализацию этих функций в ```utils.c``` :
``` c
#include "utils.h"
#include "hardware/gpio.h"

void led_on(uint pin) {
	// YOUR CODE
}

void led_off(uint pin) {
    // YOUR CODE
}
```

- Заменить ```gpio_put(LED_PIN, 0);``` и ```gpio_put(LED_PIN, 1);``` на ```led_on``` и ```led_off```.
- Увеличить период мигания светодиода
- Добавить в  ``` CMakeLists.txt ```  новый файл с исходным кодом.
- Собрать проект аналогично [[Занятие 1#4. Собираем в папке build]]
- Загрузить прошивку аналогично [[Занятие 1#5. Загружаем прошивку в Pico]]
- **Результат**: Устройство мигает с увеличенным периодом
## 2.  Помигать светодидом через COM-порт
- Скачать бинарный файл консольной программы [PUTTY](https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html).
- Добавить в ```CMakeLists.txt ``` перенаправление потока ввода/вывода с uart на usb:
``` cmake

... 

# Указываем на какие библиотеки ссылается наш код - типовая строчка для любого CMakeLists.txt
target_link_libraries(02_blink_usb_com
	pico_stdlib
)

# Перенаправляем поток ввода/вывода с uart на usb
pico_enable_stdio_usb(02_blink_usb_com 1)
pico_enable_stdio_uart(02_blink_usb_com 0)

# Добавляем задачи генерации бинарника в разных форматах - специфика сборки под Pico
pico_add_extra_outputs(02_blink_usb_com)
```
- Добавить в ```main.c ``` инициализацию потока ввода/вывода и считывание с консоли:
``` c
// подключаем библиотеки из pico SDK

#include "pico/stdlib.h"
#include "hardware/gpio.h"
#include "utils.h"

  

// задаем константу с номером ножки, к которой подключен светодиод
// номер можно узнать и проверить в документации к плате

const uint LED_PIN = 25;
  
int main()
{

    // Инициализация I/O
    stdio_init_all();

  
    // Инициализация GPIO вывода
    gpio_init(LED_PIN);
    gpio_set_dir(LED_PIN, GPIO_OUT);
    char userInput;

    // Суперцикл, определяющий логику работы микроконтроллера
    while (1)
    {
        printf("Command (on = on off = off):\n");
        userInput = getchar();
		// Логика включения и выключения диода
    }
}
```
- Собрать проект и загрузить прошивку
- Определить имя COM-порта:
	- Нажмите `Win + X` и выберите «Диспетчер устройств».
	- Разверните список **Порты (COM и LPT)**.
	- Устройство будет отображаться как «Название устройства (COM#)», например, `USB Serial Port (COM3)`.
	- Если устройство не отображается, выберите в меню «Вид» пункт «Показать скрытые устройства».
- Запустить и настроить PUTTY (выбрать тип соединения Serial,указать имя порта и скорость):
![[Pasted image 20260126154203.png]]

- **Результат**: Диод устройства включается по команде ```on``` и выключается по ```off``` в терминале PUTTY

## 3. Помигать светодиодом через Python-скрипт (on/off, задавать период)
- Проверить наличие python командой ```python --version ```, если нет то установить
- Установить ```pyserial``` для связи с COM-портом через python командой ```pip install pyserial ```
- Создать  скрипт ```control.py ``` 
- Импортировать библиотеки, настроить параметры COM-порта, не забыть закрыть COM-порт после окончания работы скрипта:
``` python
import serial, sys
  
serialName = 'COM13' 
serialBaudRate = 115200

ser = serial.Serial(serialName, baudrate=serialBaudRate)

print('start')
print('(e - switch on led / d - switch off led) / q - end execution\n')

try:
    while True:
        s = input()
        if s.startswith('q'):
            sys.exit(0)
        elif s.startswith('e'):
            sendStr = 'e'
        elif s.startswith('d'):
            sendStr = 'd'
        else:
            print(f'Invalid input: {s}')
            continue
        sendData = (sendStr + '\n').encode('ascii')
        ser.write(sendData)
        response = ser.readline()
        ser.flush()
        print(response)
finally:
    ser.close()
    print('closed')
```

## 4.  Реализовать в приборе команду toggle()
## 5. Помигать светодиодом через Python-скрипт (toggle, задавать период)
## 6.  Реализовать в приборе команды on_for(ms), off_for(ms), toggle_for(ms)
## 7. Помигать светодиодом через Python-скрипт (xx_for(ms))
## 8. Реализовать команду mem(addr) и Python-интерфейс к ней, проверить
## 9. Реализовать команду wmem(addr) и Python-интерфейс к ней, проверить
## 10. Запушить исходники прошивки и Python-интерфейс на GitHub
