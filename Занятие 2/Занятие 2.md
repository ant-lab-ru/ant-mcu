## 0. Создать проект
Создать проект 02-blink-usb-com в папке mcu аналогично [[Занятие 1#3. Создаем первый проект]]. 

В итоге должна получиться следующая структура файлов.
```
mcu
|-- 01-blink
|-- 02-blink-usb-com
 	|-- main.c
 	|-- CMakeLists.txt
 	|-- memmap_rp2040.ld
    |-- pico_sdk_import.cmake
    
```

## 1. Реализовать в прошивке команды led_on и led_off
**Цель**: В задании требуется реализовать функции ```led_on``` и ```led_off```. Применить их  в мастерцикле и убедиться, что перепрошитое устройство мигает. 

- Создать в папке [[файл с исходным кодом]] utils.c и [[заголовочный файл]] utils.h. 
-  В заголовочный файл ```utils.h ``` добавим библиотеку ```pico/stdlib.h``` 
``` c
#include "pico/stdlib.h"
```
- В заголовочном файле ``` utils.h``` объявить функции   ```led_on``` и ```led_off```:
``` c
void led_on(uint pin);
void led_off(uint pin);
```

- В файл с исходным кодом ```utils.c ``` добавим заголовочный файл ```utils.h``` и библиотеку ```hardware/gpio.h``` 
``` c
#include "utils.h"
#include "hardware/gpio.h"
```
- Добавить реализацию этих функций в ```utils.c``` :
``` c
void led_on(uint pin) {
	// Код реализующий логику включения светодиода
}

void led_off(uint pin) {
    // Код реализующий логику выключения светодиода
}
```

- Добавить в ```main.c ``` библиотеки ```hardware/gpio.h``` и ```pico/stdlib.h``` 
- Использовать функции ```led_on``` и ```led_off``` для мигания светодиода, увеличить период мигания светодиода
- Добавить в  ``` CMakeLists.txt ```  новый файл с исходным кодом ```utils.c.
``` cmake
... 
# Добавляем в проект файлы с исходным кодом - типовая строчка для любого CMakeLists.txt
add_executable(02_blink_usb_com
    ${CMAKE_CURRENT_SOURCE_DIR}/main.c
    ${CMAKE_CURRENT_SOURCE_DIR}/utils.c
)
```
- Собрать проект аналогично [[Занятие 1#4. Собираем в папке build]]
- Загрузить прошивку аналогично [[Занятие 1#5. Загружаем прошивку в Pico]]
- **Результат**: Устройство мигает с увеличенным периодом
## 2.  Помигать светодидом через COM-порт
**Цель**: В предыдущем задании мигание осуществлялось из ```main``` самой прошивки. Пользователь никак не контролирует процесс. Цель этого задания добавить возможность пользователю мигать светодиодом через терминал PUTTY с помощью команд ```e```  и ```d``` .
- Скачать бинарный файл консольной программы [PUTTY](https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html).
![[Pasted image 20260127115806.png]]
- Добавить в ```CMakeLists.txt ``` перенаправление потока ввода/вывода с uart на usb после указания файла, в котором находится linker script:
``` cmake

# Перенаправляем поток ввода/вывода с uart на usb
pico_enable_stdio_usb(02_blink_usb_com 1)
pico_enable_stdio_uart(02_blink_usb_com 0)
```
- Добавить в ```main.c ``` инициализацию потока ввода/вывода и считывание с консоли STDIO перед инициализацией GPIO вывода:
``` c
stdio_init_all();
```
- Добавить после инициализации GPIO вывода объявить переменную ```userInput``` типа
  ```char``` . Через эту переменную пользователь сможет включать или выключать светодиод:
``` c
char userInput;
```
- В мастерцикле (бесконечном цикле) считать переменную вводимую пользователем с помощью функции ```getchar()```:
``` c
userInput = getchar();
```
- Реализовать логику включения светодиода при вводе символа ```e```. После включения необходимо вывести текущий статуй с помощью функции ```printf```:
``` c
printf("LED is ON \n");
```
- Реализовать логику включения светодиода при вводе символа ```d```. После включения необходимо вывести текущий статуй с помощью функции ```printf```
- В случае ввода некорректного символа, вывести сообщение об этом
- Собрать проект и загрузить прошивку
- Определить имя COM-порта:
	- Нажмите `Win + X` и выберите «Диспетчер устройств».
	- Разверните список **Порты (COM и LPT)**.
	- Устройство будет отображаться как «Название устройства (COM#)», например, `USB Serial Port (COM3)`.
- Запустить и настроить PUTTY (выбрать тип соединения Serial,указать имя порта и скорость):
![[Pasted image 20260126154203.png]]

- **Результат**: Диод устройства включается по команде ```e``` и выключается по ```d``` в терминале PUTTY
![[Pasted image 20260127115117.png]]
## 3. Помигать светодиодом через Python-скрипт
**Цель**: В предыдущем задании пользователем являлись Вы. Нажатиями клавиш ```e```  и ```d``` Вы управляли поведением устройства через API ```led_on``` и ```led_off```. Теперь цель автоматизировать процесс мигания и сделать python-скрипт пользоватлем устройства, который взаимодействует с ним через API. Добавьте возможность изменения периода мигания (в мс). 

- Проверить наличие python командой ```python --version ```, если нет то установить
- Установить ```pyserial``` для связи с COM-портом через python командой:

```bash 
pip install pyserial 
```

- Создать  скрипт ```control.py ``` 
- Импортировать библиотеку для работы с COM-портом ```pyserial```  и библиотеку  ```sys``` для введения команд не через терминал PUTTY, а через  терминал python в VScode, time понадобится для внесения задержки между включением и выключением диода :
``` python
import serial, time
```
- Добавить параметры COM-порта:
``` python
serialName = 'COM14'
serialBaudRate = 115200
ser = serial.Serial(serialName, baudrate=serialBaudRate)
```
- Добавить вывод, обозначающий начало работы скрипта
``` python
print('start')
```

- Добавить инструкцию для пользователя для ввода параметров
 - Добавить знакомую конструкцию, и реализовать логику мигания светодиодом из python-скрипта
``` python
try:
    while True:
	# код
finally:
	# код
	
```
**Примечание**
- [[Данные записываемые в COM-порт должны быть ascii]]
- Документация на serial расположена по [ссылке](https://pyserial.readthedocs.io/en/latest/pyserial_api.html) 
- При окончании работы программы не забудьте про закрытие COM-порта.
## 4.  Реализовать в приборе команду toggle
**Цель**: В предыдущем задании в python-скрипте вызывались последовательно команды ```led_on``` и ```led_off```. Теперь добавим в прошивку устройства еще одну команду ```toggle```, которая переключает  текущее состояние светодиода на противоположное, т.е. из положения выкл в положение вкл и наоборот.
- Добавьте в ```utils.h ``` объявление новой функции:
``` c
void toggle(uint pin);
```
- Добавьте в ```utils.cpp``` реализацию новой функции:
``` c
void toggle(uint pin)
{
        gpio_put(pin, !gpio_get(pin));
}
```
- Проверьте корректность работы новой команды
## 5. Помигать светодиодом через Python-скрипт с использованием toggle
**Цель**: Помигать светодиодом с возможностью изменения периода с использованием команды ```toggle```
- Обновите python-скрипт. Команда ```toggle``` должна вызываться символом ```t``` 
## 6.  Реализовать в приборе команду blink(ms, num_blinks). Помигать с Python-скрипт и без

## ???. Реализовать команду mem(addr) и Python-интерфейс к ней, проверить

## ???. Реализовать команду wmem(addr) и Python-интерфейс к ней, проверить
## ???. Запушить исходники прошивки и Python-интерфейс на GitHub
